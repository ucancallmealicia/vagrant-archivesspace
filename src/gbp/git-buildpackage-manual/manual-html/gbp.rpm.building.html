<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Building RPM packages from the Git repository</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Building Packages with git-buildpackage suite"
HREF="index.html"><LINK
REL="UP"
TITLE="Building RPM Packages with git-buildpackage-rpm"
HREF="gbp-rpm.html"><LINK
REL="PREVIOUS"
TITLE="Development flow"
HREF="gbp.rpm.development.html"><LINK
REL="NEXT"
TITLE="Command Reference"
HREF="man.rpm.reference.html"><STYLE
TYPE="text/css"
>.synopsis, .classsynopsis {
    background: #eeeeee;
    border: solid 1px #aaaaaa;
    padding: 0.5em;
}
.programlisting {
    background: #eeeeff;
    border: solid 1px #aaaaff;
    padding: 0.5em;
}
.variablelist {
    padding: 4px;
    margin-left: 3em;
}
.navigation {
    background: #ffeeee;
    border: solid 1px #ffaaaa;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
.navigation a {
    color: #770000;
}
.navigation a:visited {
    color: #550000;
}
.navigation .title {
    font-size: 200%;
}</STYLE
></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><TABLE
WIDTH="100%"
CLASS="navigation"
SUMMARY="Navigation header"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
><A
ACCESSKEY="p"
HREF="gbp.rpm.development.html"
><IMG
SRC="left.png"
WIDTH="24"
HEIGHT="24"
BORDER="0"
ALT="Prev"></A
></TD
><TD
><A
ACCESSKEY="u"
HREF="gbp-rpm.html"
><IMG
SRC="up.png"
WIDTH="24"
HEIGHT="24"
BORDER="0"
ALT="Up"></A
></TD
><TD
><A
ACCESSKEY="h"
HREF="index.html"
><IMG
SRC="home.png"
WIDTH="24"
HEIGHT="24"
BORDER="0"
ALT="Home"></A
></TD
><TH
WIDTH="100%"
align="center"
>Building Packages with git-buildpackage suite: Version: 0.0</TH
><TD
><A
ACCESSKEY="n"
HREF="man.rpm.reference.html"
><IMG
SRC="right.png"
WIDTH="24"
HEIGHT="24"
BORDER="0"
ALT="Next"></A
></TD
></TR
></TABLE
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="GBP.RPM.BUILDING"
></A
>Building RPM packages from the <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="gbp.rpm.building.html#GBP.RPM.BUILDING.PATCH-GENERATION"
>Automatic patch generation</A
></DT
><DT
><A
HREF="gbp.rpm.building.html#GBP.RPM.BUILDING.PATCH-QUEUE"
>Working with separate development branch</A
></DT
></DL
></DIV
><P
>    The <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> tool is used for building.
    The tool creates the source tarball and copies it and the packaging files
    to a separate build directory and builds the package there. By default,
    <B
CLASS="COMMAND"
>rpmbuild</B
> is used as the builder command. You can define a different
    builder command with the <CODE
CLASS="OPTION"
>--git-builder</CODE
> option.
    </P
><P
>    To build the (non-native) package when on <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>packaging-branch</I
></SPAN
>,
    using pristine-tar to create upstream tarball:
    <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --pristine-tar
    </PRE
>
    During development, if you have unclean git tree (untracked files and/or
    uncommitted changes) you may use:
    <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-ignore-untracked
    </PRE
>
    or:
    <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-ignore-new
    </PRE
>
    </P
><P
>    Git-buildpackage-rpm always builds in a separate build directory
    (<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>./rpmbuild/</I
></SPAN
> by default). You may change that and also
    build a different revision that your current branch HEAD. The revision can
    be any git "commit-ish", i.e. branch or tag name or a commit sha1.
    Git-buildpackage also supports some "special revisions", i.e.
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>INDEX</I
></SPAN
> refer to the current index,
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>WC</I
></SPAN
> or <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>WC.IGNORED</I
></SPAN
> refer to the current working
    copy with all (even untracked and ignored) files,
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>WC.TRACKED</I
></SPAN
> refers to the current working copy of the files
    tracked by git,
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>WC.UNTRACKED</I
></SPAN
> refers to the current working copy of all files
    excluding ignore files.
    Some examples:
    <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-export-dir=/home/user/rpmbuild
    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-export-dir=/home/user/rpmbuild --git-export=v1.2.3
    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-export=WC.UNTRACKED
    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-export=INDEX
    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-export=feature/cool-new-thing
    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-export=8d55173610f
    </PRE
>
    </P
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.RPM.BUILDING.PATCH-GENERATION"
>Automatic patch generation</A
></H1
><P
>        When developing a non-native package with packaging and sources
        in the same branch
        (see <A
HREF="gbp.rpm.development.html#GBP.RPM.DEVELOPMENT.MODELS.NONNATIVE1"
>Non-native package, model 1</A
>)
        you usually want for <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> to automatically generate
        patches. In this mode, <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> generates the upstream
        tarball and copies packaging files to the build dir. After that it
        generates patches from commits between <CODE
CLASS="OPTION"
>upstream</CODE
> and the
        revision to be built, and, updates the spec file accordingly.
        Git-buildpackage-rpm also have some options to alter the patch
        generation. Build package with patch generation:
        <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-patch-export
        </PRE
>
        Ignore changes to packaging/ directory and compress patches larger
        than 100 kilobytes:
        <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
> --git-patch-export --git-patch-export-compress=100k --git-patch-export-ignore-path='^packaging/.*'
        </PRE
>
        </P
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.RPM.BUILDING.PATCH-QUEUE"
>Working with separate development branch</A
></H1
><P
>        When developing a non-native package with packaging data and source
        code in separate branches
        (see <A
HREF="gbp.rpm.development.html#GBP.RPM.DEVELOPMENT.MODELS.NONNATIVE2"
>Non-native package, model 2</A
>)
        you use the <B
CLASS="COMMAND"
>gbp pq-rpm</B
> tool to handle the patches. You work on the
        source code on the development branch and then <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>export</I
></SPAN
>
        the patches to the packaging branch when building the RPM package.
        </P
><P
>        Create a <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>development</I
></SPAN
> (or <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>patch-queue</I
></SPAN
>) branch
        by applying the patches in current packaging branch on top of the
        upstream version. This will create a new branch, e.g.
        <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>development/master</I
></SPAN
> assuming your current branch is
        <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>master</I
></SPAN
>. Simply:
        <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp pq-rpm</B
> import
        </PRE
>
        Now you can develop normally on the development branch (add, remove,
        rebase, amend commits). Just make sure you stay based on the correct
        upstream version, if doing git-rebase. After you're happy with your
        changes and you're ready to build an RPM package, you have to
        <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>export</I
></SPAN
> the patches with <B
CLASS="COMMAND"
>gbp pq-rpm</B
>. This will change
        back to you packaging branch, generate patches from commits between
        between <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>upstream</I
></SPAN
> and the HEAD of the development branch
        and update the spec file with the new patches:
        <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>gbp pq-rpm</B
> export
        </PRE
>
        Commit the changes to packaging branch, and build. For example:
        <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>git add</B
> *patch *spec
    $ <B
CLASS="COMMAND"
>git commit</B
> -a
    $ <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
>
        </PRE
>
        Of course you can build even without committing by using the
        <CODE
CLASS="OPTION"
>--git-export=WC.UNTRACKED</CODE
> option of <B
CLASS="COMMAND"
>gbp buildpackage-rpm</B
>.
        </P
><P
>        Moving to a new upstream version is basically simple. Assuming you
        have imported/pulled new upstream version to your git-tree, just:
        <PRE
CLASS="SCREEN"
>    $ <B
CLASS="COMMAND"
>git checkout</B
> master
    # Edit the spec file and change the 'Version:' tag to new upstream version
    $ <B
CLASS="COMMAND"
>vim</B
> *spec
    $ <B
CLASS="COMMAND"
>git commit</B
> *spec
    $ <B
CLASS="COMMAND"
>gbp pq-rpm</B
> rebase
        </PRE
>
        However, if the patches do not apply cleanly, you have to manually
        apply and resolve the patches.
        </P
></DIV
></DIV
><TABLE
CLASS="navigation"
WIDTH="100%"
SUMMARY="Navigation footer"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
ALIGN="left"
><A
ACCESSKEY="p"
HREF="gbp.rpm.development.html"
><B
>&lt;&lt;&lt;&nbsp;Development flow</B
></A
></TD
><TD
ALIGN="right"
><A
ACCESSKEY="n"
HREF="man.rpm.reference.html"
><B
>Command Reference&nbsp;&gt;&gt;&gt;</B
></A
></TD
></TR
></TABLE
></BODY
></HTML
>